<Window x:Class="TaskManagerApp.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:TaskManagerApp.Converters"
        mc:Ignorable="d"
        Title="任务管理" Height="600" Width="800">
    <Window.Resources>
        <!-- 注册 NullableEnumToStringConverter -->
        <converters:NullableEnumToStringConverter x:Key="NullableEnumToStringConverter" />
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 筛选面板 -->
        <StackPanel Orientation="Horizontal" Margin="10">
            <!-- 分类 ComboBox -->
            <ComboBox Width="120"
                      ItemsSource="{Binding Categories}"
                      SelectedItem="{Binding SelectedCategory}"
                      DisplayMemberPath="Name" />
            <!-- 状态 ComboBox -->
            <ComboBox Width="100" Margin="10,0,0,0"
                      ItemsSource="{Binding StatusList}"
                      SelectedItem="{Binding SelectedStatus}">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Converter={StaticResource NullableEnumToStringConverter}, ConverterParameter=全部}" />
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
            <!-- 优先级 ComboBox -->
            <ComboBox Width="100" Margin="10,0,0,0"
                      ItemsSource="{Binding PriorityList}"
                      SelectedItem="{Binding SelectedPriority}">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Converter={StaticResource NullableEnumToStringConverter}, ConverterParameter=全部}" />
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
            <!-- 日期区间 -->
            <DatePicker SelectedDate="{Binding DueDateFrom}" Width="120" Margin="10,0,0,0" />
            <DatePicker SelectedDate="{Binding DueDateTo}" Width="120" Margin="10,0,0,0" />
            <Button Content="筛选" Command="{Binding FilterTasksCommand}" Margin="10,0,0,0"/>
        </StackPanel>

        <!-- 任务列表 DataGrid -->
        <DataGrid Grid.Row="1" ItemsSource="{Binding Tasks}" AutoGenerateColumns="False"
                  Margin="10" IsReadOnly="True"
                  SelectedItem="{Binding SelectedTask}">
            <DataGrid.Columns>
                <DataGridTextColumn Header="标题" Binding="{Binding Title}" Width="*" />
                <DataGridTextColumn Header="截止时间"
                                    Binding="{Binding DueDate, StringFormat=yyyy-MM-dd HH:mm}"
                                    Width="150" />
                <DataGridTextColumn Header="优先级" Binding="{Binding Priority}" Width="80" />
                <DataGridTextColumn Header="状态" Binding="{Binding Status}" Width="80" />
                <DataGridTextColumn Header="分类" Binding="{Binding Category.Name}" Width="100" />
            </DataGrid.Columns>
        </DataGrid>

        <!-- 底部操作 -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="10">
            <Button Content="新增" Command="{Binding AddTaskCommand}" Width="80"/>
            <Button Content="编辑" Command="{Binding EditTaskCommand}" Width="80" Margin="10,0,0,0"/>
            <Button Content="删除" Command="{Binding DeleteTaskCommand}" Width="80" Margin="10,0,0,0"/>
            <Button Content="导出" Command="{Binding ExportTasksCommand}" Width="80" Margin="10,0,0,0"/>
            <Button Content="管理分类" Command="{Binding ManageCategoriesCommand}" Width="100" Margin="10,0,0,0"/>
        </StackPanel>
    </Grid>
</Window>
